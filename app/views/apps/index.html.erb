<h1>BHOF: Your Applications</h1>

<% if @apps_incomplete > 0 %>
    <div class="alert alert-info">
      <!-- only show if apps exist ? -->
      <strong>Heads Up!</strong> Applications will not be accepted until they are submitted. You have
      <%= pluralize(@apps_incomplete, "incomplete application") %>.
    </div>
<% end %>

<div class="well">
  <p>
    You may submit up to two (2) solo and up to two (2) group acts per account.<BR>
    Click "Dashboard" below to 
    go to your application's dashboard, where you can see the status of each of your applications and submit all of the
    required information. 
  </p>

<style>
div#clock { color: white; margin: 20px auto; width: 600px; overflow: hidden; text-align: center; }
div#clock p { background: #333; float: left; height: 100px; width: 88px; }
div#clock p span { display: block; font-size: 50px; font-weight: bold; padding: 5px 0 0; }
div#clock div.space { color: #ccc; display: block; line-height: 1.7em; font-size: 50px; float: left; height: 100px; width: 30px; }
div.coupon{ color: #333 !important; font-size: 50px; font-weight: bold; }
div.multi_clock{ border: 1px solid #666; color: #333; float: left; margin: 10px; padding: 5px; }
pre{background-color: #eee; border: 1px solid #ccc; line-height: 1.4em; padding: 10px; margin: 0;}
</style>
<%= javascript_include_tag "jquery.countdown.js" %>
<script type="text/javascript" charset="utf-8">
$(function() {
  // TODO: don't hardcode this date. Derive from BHOF_DEADLINE
  var deadlineDate = new Date(
<%=BHOF_FINAL_DEADLINE.to_time.in_time_zone('US/Pacific').strftime("%Y") %>,
<%=BHOF_FINAL_DEADLINE.to_time.in_time_zone('US/Pacific').strftime("%-m") %>,
<%=BHOF_FINAL_DEADLINE.to_time.in_time_zone('US/Pacific').strftime("%-d") %>,
<%=BHOF_FINAL_DEADLINE.to_time.in_time_zone('US/Pacific').strftime("%H") %>,
<%=BHOF_FINAL_DEADLINE.to_time.in_time_zone('US/Pacific').strftime("%S") %>);
  $('div#clock').countdown(deadlineDate, function(event) {
    $this = $(this);
    switch(event.type) {
      case "seconds":
      case "minutes":
      case "hours":
      case "days":
      case "weeks":
      case "daysLeft":
        $this.find('span#'+event.type).html(event.value);
        break;
      case "finished":
        $this.fadeTo('slow', .5);
        break;
    }
  });
});
</script>
<!-- HTML -->
<P ALIGN=CENTER><strong>Application Deadline: <%=BHOF_FINAL_DEADLINE.to_time.in_time_zone('US/Pacific').strftime(SHORT_TIME_FMT_TZ) %>
</strong></P>
<div id="clock">
  <p>
    <span id="weeks"></span>
    Weeks
  </p>
  <div class="space">:</div>
  <p>
    <span id="daysLeft"></span>
    Days
  </p>
  <div class="space">:</div>
  <p>
    <span id="hours"></span>
    Hours
  </p>
  <div class="space">:</div>
  <p>
    <span id="minutes"></span>
    Minutes
  </p>
  <div class="space">:</div>
  <p>
    <span id="seconds"></span>
    Seconds
  </p>
</div>
</div>
<P>
  <a href="/apps/new" class="btn btn-primary"><i class="glyphicon glyphicon-plus-sign white"></i>&nbsp;Create a new
    Application</a>
</p>

<% if @apps.count > 0 %>
    <table class="table table-striped">
      <thead>
      <tr>
        <th>Created</th>
        <th>Description</th>
        <TH>Status</TH>
        <th></th>
      </tr>
      </thead>

      <tbody>
      <% @apps.each do |app| %>
          <tr>
            <td><%= app.created_at.to_time.in_time_zone('US/Pacific').strftime(SHORT_TIME_FMT_TZ) %></td>
            <td>
              <% if app.entry -%>
                  <% if app.entry.type == 1 -%>
                      <strong>Solo: </strong>
                  <% elsif app.entry.type == 2 %>
                      <strong>Group: </strong>
                  <% end -%>
              <% end -%>
              <%= app.description %></td>
            <td>
              <% if app.entry.nil? or
                    app.entry_techinfo.nil? or
                    app.is_complete? == false or
                    app.entry.is_complete? == false or
                    app.entry_techinfo.is_complete? == false or
                    app.purchased_at.nil? -%>
                  <I>Incomplete</I>
              <% else -%>
                  <% if app.locked -%>
                      <I>Submitted. Good Luck!</I>
                  <% else -%>
                      <I>Ready - Needs Submission</I>
                  <% end -%>
              <% end -%>
            </TD>

            <td><a href="/apps/<%= app.id.to_s %>/dashboard" class="btn btn-success btn-sm">Dashboard</a>
              <%= link_to 'Edit', edit_app_path(app), class: "btn btn-primary btn-sm" %>
              <%= link_to 'Destroy', app, method: :delete, data: {confirm: 'Destroying an application will permanently erase it, and if you have paid for the application, will forfeit your payment. Are you sure?'}, class: "btn btn-danger btn-sm" %>

            </td>
          </tr>
      <% end %>
      </tbody>
    </table>
<% else %>
    <h4>You currently have no applications. Create one!</h4>
<% end %>
